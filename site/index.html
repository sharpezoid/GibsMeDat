<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>GIBS ME DAT - $GIBS</title>
    <link rel="stylesheet" href="styles.css" />
    <script
      crossorigin
      src="https://unpkg.com/react@18/umd/react.production.min.js"
    ></script>
    <script
      crossorigin
      src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/ethers@6.6.0/dist/ethers.min.js"></script>
  </head>
  <body>
    <div id="root"></div>
    <script type="text/javascript">
      const { useState, useEffect } = React;
      const tokenAddress = '0x0000000000000000000000000000000000000000';
      const tokenAbi = [
        'function totalSupply() view returns (uint256)',
        'function symbol() view returns (string)',
      ];
      const expectedChainId = 1; // Ethereum mainnet

      function MiddlePanel() {
        return React.createElement(
          'div',
          { className: 'middle-panel' },
          React.createElement(
            'h2',
            { className: 'subtitle' },
            '$GIBS â€“ From each according to their bags, to each according to their memes.'
          )
        );
      }

      function Navigation() {
        return React.createElement(
          'header',
          { className: 'nav-area' },
          React.createElement('img', {
            src: 'images/GibsTokenLogo.png',
            className: 'nav-logo',
            alt: 'GIBS logo',
          }),
          React.createElement(
            'nav',
            { className: 'nav' },
            React.createElement(
              'button',
              {
                className: 'nav-button',
                onClick: () => (window.location.href = 'index.html'),
              },
              'Main'
            ),
            React.createElement(
              'button',
              {
                className: 'nav-button',
                onClick: () => (window.location.href = 'manifesto.html'),
              },
              'Manifesto'
            )
          ),
          React.createElement('img', {
            src: 'images/GibsTokenLogo.png',
            className: 'nav-logo mirror',
            alt: 'GIBS logo mirrored',
          })
        );
      }

      function App() {
        const [supply, setSupply] = useState('6,942,080,085');
        const [gulaged, setGulaged] = useState('0');
        const [connected, setConnected] = useState(false);
        const [provider, setProvider] = useState(null);
        const [message, setMessage] = useState('');

        async function loadSupply(currentProvider = provider) {
          try {
            if (!currentProvider) {
              setMessage('Connect your wallet to view supply.');
              return;
            }
            const contract = new ethers.Contract(
              tokenAddress,
              tokenAbi,
              currentProvider
            );
            const total = await contract.totalSupply();
            setSupply(ethers.formatUnits(total, 18));
            setMessage('');
          } catch (err) {
            setMessage(`Error loading supply: ${err.message}`);
          }
        }

        async function connect() {
          if (!window.ethereum) {
            setMessage('No Ethereum provider detected. Please install MetaMask.');
            return;
          }
          try {
            const newProvider = new ethers.BrowserProvider(window.ethereum);
            await newProvider.send('eth_requestAccounts', []);
            const network = await newProvider.getNetwork();
            if (network.chainId !== expectedChainId) {
              setMessage('Please switch to the Ethereum mainnet.');
              return;
            }
            setProvider(newProvider);
            setConnected(true);
            setMessage('');
            loadSupply(newProvider);
          } catch (err) {
            setMessage(`Connection error: ${err.message}`);
          }
        }

        useEffect(() => {
          if (connected && provider) {
            loadSupply(provider);
          }
        }, [connected, provider]);

        return React.createElement(
          React.Fragment,
          null,
          React.createElement(Navigation),
          React.createElement(
            'main',
            { className: 'container' },
            React.createElement(MiddlePanel),
            React.createElement(
              'ul',
              { className: 'stats' },
              React.createElement('li', null, `Total Supply: ${supply}`),
              React.createElement('li', null, `Total Gulaged: ${gulaged}`),
              React.createElement(
                'li',
                null,
                'Transfer Tax: 0.69% (0.3% reflection, 0.3% treasury, 0.09% burn)'
              )
            ),
            React.createElement(
              'button',
              { onClick: connect, className: 'connect' },
              connected ? 'Wallet Connected' : 'Connect Wallet'
            ),
            message &&
              React.createElement(
                'p',
                { className: 'error' },
                message
              ),
            React.createElement(
              'p',
              { className: 'footer' },
              'Stake in the Proletariat Vault, help craft the on-chain Meme Manifesto, and direct the Gibs Treasury DAO.'
            )
          )
        );
      }

      ReactDOM.createRoot(document.getElementById('root')).render(
        React.createElement(App)
      );
    </script>
  </body>
</html>
